# # Since the formula for xv-CIC requires the computation of difficult derivatives of copula densities, 
# # we will use the "Yacas" computer algebra system, implemented in the "Ryacas" library, 
# # to handle all the difficult differentiations automatically.
# 
# library("Ryacas")
# 
# # Here we specify the symbolic variables with respect to which we will need to differentiate.
# u <- ysym("u")
# v <- ysym("v")
# param <- ysym("param")





# ###### Clayton copula
# 
# ### The following are algebraic expressions related to the Clayton copula density
# 
# # the following expression is the log-density of the Clayton copula
# expr_log_clayton <- log((1+param)*(u^(-1-param))*(v^(-1-param))*(-1 + u^(-param) +v^(-param))^(-2-1/param))
# 
# # the following expressions are the partial derivatives of the log-density of the Clayton copula
# expr_du_log_clayton <- deriv(expr_log_clayton, "u")
# expr_dv_log_clayton <- deriv(expr_log_clayton, "v")
# 
# # the following expression defines the function phi_clayton, obtained by differentiating the log-density 
# # of the Clayton copula with respect to the parameter
# expr_phi_clayton <- deriv(expr_log_clayton, "param")
# 
# # the following expressions are the partial derivatives of the phi_clayton function
# expr_dparam_phi_clayton <- deriv(expr_phi_clayton, "param")
# expr_du_phi_clayton <- deriv(expr_phi_clayton, "u")
# expr_dv_phi_clayton <- deriv(expr_phi_clayton, "v")

### The following are the implementations of R functions related to the algebraic expressions about Clayton copula

log_clayton <- Vectorize(function(u, v, param) {
  result <- log((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))
  return(result)
  }, vectorize.args = c("u", "v"))

d_log_clayton <- Vectorize(function(u, v, param){
  du_log_clayton <- ((param+1)*u^(-(param+1))*v^(-(param+1))*(1/param+2)*param*u^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))-u^(-(param+2))*(param+1)^2*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))/((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))
  dv_log_clayton <- ((param+1)*u^(-(param+1))*v^(-(param+1))*(1/param+2)*param*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))-u^(-(param+1))*(param+1)^2*v^(-(param+2))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))/((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))
  return(c(du_log_clayton, dv_log_clayton))
}, vectorize.args = c("u", "v"))

phi_clayton <- Vectorize(function(u, v, param) {
  result <- ((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))/((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))
  return(result)
  }, vectorize.args = c("u", "v"))

dparam_phi_clayton <- Vectorize(function(u, v, param) {
  result <- ((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((u^(-param)+v^(-param)-1)*((-(v^(-param)*log(v)+u^(-param)*log(u)))/param^2-(1/param+2)*(u^(-param)*log(u)^2+v^(-param)*log(v)^2))+(1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u))^2)/(u^(-param)+v^(-param)-1)^2-((param^2*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)+2*log(u^(-param)+v^(-param)-1)*param)/param^4)+((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)-((u^(-(param+1))*log(u)+(u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*log(u))*v^(-(param+1))+(u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))*log(v)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))-((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))^2)/((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))^2
  return(result)
  }, vectorize.args = c("u", "v"))

du_phi_clayton <- Vectorize(function(u, v, param) {
  result <- ((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((u^(-param)+v^(-param)-1)*(1/param+2)*(u^(-param)/u-param*u^(-(param+1))*log(u))+(1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u))*param*u^(-(param+1)))/(u^(-param)+v^(-param)-1)^2-(param*u^(-(param+1)))/((u^(-param)+v^(-param)-1)*param^2))+((param+1)*u^(-(param+1))*v^(-(param+1))*(1/param+2)*param*u^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))-u^(-(param+2))*(param+1)^2*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(1/param+2)*param*u^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))+(u^(-(param+2))*(param+1)^2*v^(-(param+1))*log(v)-((param+1)*u^(-(param+2))+((param+1)*u^(-(param+1)))/u-u^(-(param+2))*(param+1)^2*log(u))*v^(-(param+1)))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))-((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))*((param+1)*u^(-(param+1))*v^(-(param+1))*(1/param+2)*param*u^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))-u^(-(param+2))*(param+1)^2*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))))/((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))^2
  return(result)
  }, vectorize.args = c("u", "v"))

dv_phi_clayton <- Vectorize(function(u, v, param) {
  result <- ((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((u^(-param)+v^(-param)-1)*(1/param+2)*(v^(-param)/v-param*v^(-(param+1))*log(v))+(1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u))*param*v^(-(param+1)))/(u^(-param)+v^(-param)-1)^2-(param*v^(-(param+1)))/((u^(-param)+v^(-param)-1)*param^2))+((param+1)*u^(-(param+1))*v^(-(param+1))*(1/param+2)*param*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))-u^(-(param+1))*(param+1)^2*v^(-(param+2))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(1/param+2)*param*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))-((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*(param+1)*v^(-(param+2))+((param+1)*u^(-(param+1))*v^(-(param+1)))/v-u^(-(param+1))*(param+1)^2*v^(-(param+2))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))-((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2))*(((1/param+2)*(v^(-param)*log(v)+u^(-param)*log(u)))/(u^(-param)+v^(-param)-1)-(-log(u^(-param)+v^(-param)-1))/param^2)+((u^(-(param+1))-(param+1)*u^(-(param+1))*log(u))*v^(-(param+1))-(param+1)*u^(-(param+1))*v^(-(param+1))*log(v))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))*((param+1)*u^(-(param+1))*v^(-(param+1))*(1/param+2)*param*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+3))-u^(-(param+1))*(param+1)^2*v^(-(param+2))*(u^(-param)+v^(-param)-1)^(-(1/param+2))))/((param+1)*u^(-(param+1))*v^(-(param+1))*(u^(-param)+v^(-param)-1)^(-(1/param+2)))^2
  return(result)
  }, vectorize.args = c("u", "v"))

z_function_clayton <- Vectorize(function(u, v, param, data, du_phi_clayton_vec, dv_phi_clayton_vec){
  
  result <- sum(du_phi_clayton_vec*(as.integer(u <= data[,1])-data[,1]))/nrow(data) +
    sum(dv_phi_clayton_vec*(as.integer(v <= data[,2])-data[,2]))/nrow(data)
  
  return(result)
}, vectorize.args = c("u", "v"))





###### Gumbel copula

# ### The following are algebraic expressions related to the Gumbel copula density
# 
# # the following expression is the log-density of the Gumbel copula
# expr_log_gumbel <- log((((-log(u))^(-1+param))*((-log(v))^(-1+param))*(-1+param+((-log(u))^param + (-log(v))^param )^(1/param))*
#                           (( (-log(u))^param + (-log(v))^param )^(-2+ 1/param)))/(u*v*exp(((-log(u))^param + (-log(v))^param)^(1/param))))
# # the following expressions are the partial derivatives of the log-density of the Gumbel copula
# expr_du_log_gumbel <- deriv(expr_log_gumbel, "u")
# expr_dv_log_gumbel <- deriv(expr_log_gumbel, "v")
# 
# # the following expression defines the function phi_gumbel, obtained by differentiating the log-density
# # of the Gumbel copula with respect to the parameter
# expr_phi_gumbel <- deriv(expr_log_gumbel, "param")
# 
# # the following expressions are the partial derivatives of the phi_gumbel function
# expr_dparam_phi_gumbel <- deriv(expr_phi_gumbel, "param")
# expr_du_phi_gumbel <- deriv(expr_phi_gumbel, "u")
# expr_dv_phi_gumbel <- deriv(expr_phi_gumbel, "v")

### The following are the implementations of R functions related to the algebraic expressions about Gumbel copula

log_gumbel <- Vectorize(function(u, v, param) {
  result <- log((((-log(u))^(-1+param))*((-log(v))^(-1+param))*(-1+param+((-log(u))^param + (-log(v))^param )^(1/param))*
                   (( (-log(u))^param + (-log(v))^param )^(-2+ 1/param)))/(u*v*exp(((-log(u))^param + (-log(v))^param)^(1/param))))
  return(result)
  }, vectorize.args = c("u", "v"))

d_log_gumbel <- Vectorize(function(u, v, param){
  du_log_gumbel <- ((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((((param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*(-log(v))^(param-1)*(-log(u))^(param-2)*(1-param))/u-((-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(u))^(param-1)*param)/u)-(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(v*exp(((-log(u))^param+(-log(v))^param)^(1/param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param)))*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))/((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2))
  dv_log_gumbel <- ((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((((param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*(-log(u))^(param-1)*(-log(v))^(param-2)*(1-param))/v-((-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(v))^(param-1)*param)/v)-(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(u*exp(((-log(u))^param+(-log(v))^param)^(1/param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param)))*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))/((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2))
  return(c(du_log_gumbel, dv_log_gumbel))
}, vectorize.args = c("u", "v"))

phi_gumbel <- Vectorize(function(u, v, param) {
  result <- ((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))/((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2))
  return(result)
  }, vectorize.args = c("u", "v"))

dparam_phi_gumbel <- Vectorize(function(u, v, param) {
  result <- ((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*((((-log(u))^param+(-log(v))^param)*((1/param-2)*((-log(u))^param*log(-log(u))^2+(-log(v))^param*log(-log(v))^2)-((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))/param^2)-(1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))^2)/((-log(u))^param+(-log(v))^param)^2-((param^2*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-2*log((-log(u))^param+(-log(v))^param)*param)/param^4)+((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+(((-log(u))^(param-1)*(-log(v))^(param-1)*(param^2*(((-log(u))^param+(-log(v))^param)^(1/param)*((((-log(u))^param+(-log(v))^param)*(param*((-log(u))^param*log(-log(u))^2+(-log(v))^param*log(-log(v))^2)+(-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))-param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))^2)/((-log(u))^param+(-log(v))^param)^2-((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))/((-log(u))^param+(-log(v))^param))+(((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param))^2)/param^2)-2*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param))*param))/param^4+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+(((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))^2*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))+(((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2-(param^2*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((((-log(u))^param+(-log(v))^param)*(param*((-log(u))^param*log(-log(u))^2+(-log(v))^param*log(-log(v))^2)+(-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))-param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))^2)/((-log(u))^param+(-log(v))^param)^2-((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))/((-log(u))^param+(-log(v))^param))+(((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+(((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))*((-log(u))^param+(-log(v))^param)^(1/param))*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))-2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param))*param)/param^4)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*log(-log(u))+(2*(-log(u))^(param-1)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2)))/((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2))^2
  return(result)
  }, vectorize.args = c("u", "v"))

du_phi_gumbel <- Vectorize(function(u, v, param) {
  result <- ((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*((((-log(u))^param+(-log(v))^param)*(1/param-2)*((-log(u))^param/(u*log(u))-(log(-log(u))*(-log(u))^(param-1)*param)/u)-(-(1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))*(-log(u))^(param-1)*param)/u)/((-log(u))^param+(-log(v))^param)^2-(-(-log(u))^(param-1)*param)/(u*((-log(u))^param+(-log(v))^param)*param^2))+((((param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*(-log(v))^(param-1)*(-log(u))^(param-2)*(1-param))/u-((-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(u))^(param-1)*param)/u)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+(((-log(u))^(param-1)*(-log(v))^(param-1)*(((-log(u))^param+(-log(v))^param)^(1/param)*((((-log(u))^param+(-log(v))^param)*param*((-log(u))^param/(u*log(u))-(log(-log(u))*(-log(u))^(param-1)*param)/u)-(-param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))*(-log(u))^(param-1)*param)/u)/((-log(u))^param+(-log(v))^param)^2-(-(-log(u))^(param-1)*param)/(u*((-log(u))^param+(-log(v))^param)))-(((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param)))/param^2+(((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)*(-log(v))^(param-1)*(-log(u))^(param-2)*(1-param))/u+((log(-log(v))*(-log(v))^(param-1)*(-log(u))^(param-2)*(1-param))/u+((-log(u))^(param-1)/(u*log(u))+(log(-log(u))*(-log(u))^(param-2)*(1-param))/u)*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)-(((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-(((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(u))^(param-1)*param)/u)+(v*exp(((-log(u))^param+(-log(v))^param)^(1/param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((((-log(u))^param+(-log(v))^param)*param*((-log(u))^param/(u*log(u))-(log(-log(u))*(-log(u))^(param-1)*param)/u)-(-param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))*(-log(u))^(param-1)*param)/u)/((-log(u))^param+(-log(v))^param)^2-(-(-log(u))^(param-1)*param)/(u*((-log(u))^param+(-log(v))^param)))+((((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)+((((param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*(-log(v))^(param-1)*(-log(u))^(param-2)*(1-param))/u-((-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(u))^(param-1)*param)/u)*u)*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((-log(u))^param+(-log(v))^param)^(1/param)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u)*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))-((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*(((((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-2)*(1-param))/u+2*(v*exp(((-log(u))^param+(-log(v))^param)^(1/param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*(-log(u))^(param-1))*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)-((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(u))^(param-1)*param)/(u*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(u))^(param-1)*param)/u))/((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2))^2
  return(result)
  }, vectorize.args = c("u", "v"))

dv_phi_gumbel <- Vectorize(function(u, v, param) {
  result <- ((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u+(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*((((-log(u))^param+(-log(v))^param)*(1/param-2)*((-log(v))^param/(v*log(v))-(log(-log(v))*(-log(v))^(param-1)*param)/v)-(-(1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))*(-log(v))^(param-1)*param)/v)/((-log(u))^param+(-log(v))^param)^2-(-(-log(v))^(param-1)*param)/(v*((-log(u))^param+(-log(v))^param)*param^2))+((((param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*(-log(u))^(param-1)*(-log(v))^(param-2)*(1-param))/v-((-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(v))^(param-1)*param)/v)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+(((-log(u))^(param-1)*(-log(v))^(param-1)*(((-log(u))^param+(-log(v))^param)^(1/param)*((((-log(u))^param+(-log(v))^param)*param*((-log(v))^param/(v*log(v))-(log(-log(v))*(-log(v))^(param-1)*param)/v)-(-param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))*(-log(v))^(param-1)*param)/v)/((-log(u))^param+(-log(v))^param)^2-(-(-log(v))^(param-1)*param)/(v*((-log(u))^param+(-log(v))^param)))-(((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param)))/param^2+(((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)*(-log(u))^(param-1)*(-log(v))^(param-2)*(1-param))/v+(((-log(u))^(param-1)*(-log(v))^(param-1))/(v*log(v))+(log(-log(v))*(-log(u))^(param-1)*(-log(v))^(param-2)*(1-param))/v+((-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-2)*(1-param))/v)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)-(((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-(((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(v))^(param-1)*param)/v)+(u*exp(((-log(u))^param+(-log(v))^param)^(1/param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((((-log(u))^param+(-log(v))^param)*param*((-log(v))^param/(v*log(v))-(log(-log(v))*(-log(v))^(param-1)*param)/v)-(-param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v)))*(-log(v))^(param-1)*param)/v)/((-log(u))^param+(-log(v))^param)^2-(-(-log(v))^(param-1)*param)/(v*((-log(u))^param+(-log(v))^param)))+((((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u+((((param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*(-log(u))^(param-1)*(-log(v))^(param-2)*(1-param))/v-((-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(v))^(param-1)*param)/v)*u*v)*exp(((-log(u))^param+(-log(v))^param)^(1/param))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((-log(u))^param+(-log(v))^param)^(1/param)-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v)*exp(((-log(u))^param+(-log(v))^param)^(1/param))-((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*(((1/param-2)*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)/param^2)+((-log(u))^(param-1)*(-log(v))^(param-1)*((((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2+1)+((-log(u))^(param-1)*(-log(v))^(param-1)*log(-log(v))+(-log(u))^(param-1)*log(-log(u))*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1))*((-log(u))^param+(-log(v))^param)^(1/param-2))-((-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param)*((param*((-log(u))^param*log(-log(u))+(-log(v))^param*log(-log(v))))/((-log(u))^param+(-log(v))^param)-log((-log(u))^param+(-log(v))^param)))/param^2)*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*(((((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-2)*(1-param))/v+2*(u*exp(((-log(u))^param+(-log(v))^param)^(1/param))-(u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param))*(-log(u))^(param-1)*(-log(v))^(param-1))*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)-((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*((-log(u))^param+(-log(v))^param)^(1/param-1)*(-log(v))^(param-1)*param)/(v*param))*((-log(u))^param+(-log(v))^param)^(1/param-2)-((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-3)*(1/param-2)*(-log(v))^(param-1)*param)/v))/((u*v*exp(((-log(u))^param+(-log(v))^param)^(1/param)))^2*(-log(u))^(param-1)*(-log(v))^(param-1)*(param+((-log(u))^param+(-log(v))^param)^(1/param)-1)*((-log(u))^param+(-log(v))^param)^(1/param-2))^2
  return(result)
  }, vectorize.args = c("u", "v"))

z_function_gumbel <- Vectorize(function(u, v, param, data, du_phi_gumbel_vec, dv_phi_gumbel_vec){
  
  result <- sum(du_phi_gumbel_vec*(as.integer(u <= data[,1])-data[,1]))/nrow(data) +
    sum(dv_phi_gumbel_vec*(as.integer(v <= data[,2])-data[,2]))/nrow(data)
  
  return(result)
}, vectorize.args = c("u", "v"))





# ###### Joe copula
# 
# ### The following are algebraic expressions related to the Joe copula density
# 
# # the following expression is the log-density of the Joe copula
# expr_log_joe <- log(((1-u)^(-1+param))*(param-(-1+(1-u)^param)*(-1+(1-v)^param))*
#                       (((1-u)^param + (1-v)^param - ((1-u)^param)*((1-v)^param))^(-2+1/param))*((1-v)^(-1+param)))
# 
# # the following expressions are the partial derivatives of the log-density of the Joe copula
# expr_du_log_joe <- deriv(expr_log_joe, "u")
# expr_dv_log_joe <- deriv(expr_log_joe, "v")
# 
# # the following expression defines the function phi_joe, obtained by differentiating the log-density 
# # of the Joe copula with respect to the parameter
# expr_phi_joe <- deriv(expr_log_joe, "param")
# 
# # the following expressions are the partial derivatives of the phi_joe function
# expr_dparam_phi_joe <- deriv(expr_phi_joe, "param")
# expr_du_phi_joe <- deriv(expr_phi_joe, "u")
# expr_dv_phi_joe <- deriv(expr_phi_joe, "v")

### The following are the implementations of R functions related to the algebraic expressions about Joe copula

log_joe <- Vectorize(function(u, v, param) {
  result <- log(((1-u)^(-1+param))*(param-(-1+(1-u)^param)*(-1+(1-v)^param))*
                  (((1-u)^param + (1-v)^param - ((1-u)^param)*((1-v)^param))^(-2+1/param))*((1-v)^(-1+param)))
  return(result)
  }, vectorize.args = c("u", "v"))

d_log_joe <- Vectorize(function(u, v, param){
  du_log_joe <- (((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*(param*(1-u)^(param-1)*(1-v)^param-param*(1-u)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(param*(1-u)^(param-1)^2*((1-v)^param-1)+(1-param)*(1-u)^(param-2)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))/((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1))
  dv_log_joe <- ((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-param)*(1-v)^(param-2)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*((1-u)^param*param*(1-v)^(param-1)-param*(1-v)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(1-u)^(param-1)*((1-u)^param-1)*param*(1-v)^(param-1)*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))/((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1))
  return(c(du_log_joe, dv_log_joe))
}, vectorize.args = c("u", "v"))

phi_joe <- Vectorize(function(u, v, param) {
  result <- ((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))/((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1))
  return(result)
  }, vectorize.args = c("u", "v"))

dparam_phi_joe <- Vectorize(function(u, v, param) {
  result <- ((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*(((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1)*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*((((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)*((1/param-2)*((1-u)^param*log(1-u)^2+(1-v)^param*log(1-v)^2-(((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)^2*(1-v)^param))+((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param-((1-u)^param*log(1-u)+(1-v)^param*log(1-v)))/param^2)-(1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param))^2)/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^2-((param^2*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-2*log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)*param)/param^4)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*log(1-u)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))-(1-u)^(param-1)*((((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)^2*((1-v)^param-1))+(1-u)^(param-1)*log(1-u)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)^2*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))-((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))^2)/((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1))^2
  return(result)
  }, vectorize.args = c("u", "v"))

du_phi_joe <- Vectorize(function(u, v, param) {
  result <- ((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*(((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*(param*(1-u)^(param-1)*(1-v)^param-param*(1-u)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(param*(1-u)^(param-1)^2*((1-v)^param-1)+(1-param)*(1-u)^(param-2)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1)*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*((((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)*(1/param-2)*((param*(1-u)^(param-1)*log(1-u)+(1-u)^param/(1-u))*(1-v)^param+param*(1-u)^(param-1)*(1-v)^param*log(1-v)-(param*(1-u)^(param-1)*log(1-u)+(1-u)^param/(1-u)))-(1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param))*(param*(1-u)^(param-1)*(1-v)^param-param*(1-u)^(param-1)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^2-(param*(1-u)^(param-1)*(1-v)^param-param*(1-u)^(param-1))/(((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)*param^2))+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*(param*(1-u)^(param-1)*(1-v)^param-param*(1-u)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(param*(1-u)^(param-1)^2*((1-v)^param-1)+(1-param)*(1-u)^(param-2)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*(1/param-2)*(param*(1-u)^(param-1)*(1-v)^param-param*(1-u)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+((1-u)^(param-1)*((param*(1-u)^(param-1)*log(1-u)+(1-u)^param/(1-u))*((1-v)^param-1)+param*(1-u)^(param-1)*(1-v)^param*log(1-v))+(1-param)*(1-u)^(param-2)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*param*(1-u)^(param-1)*((1-v)^param-1)+((1-param)*(1-u)^(param-2)*log(1-u)-(1-u)^(param-1)/(1-u))*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))-((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))*((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*(param*(1-u)^(param-1)*(1-v)^param-param*(1-u)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(param*(1-u)^(param-1)^2*((1-v)^param-1)+(1-param)*(1-u)^(param-2)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))/((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1))^2
  return(result)
  }, vectorize.args = c("u", "v"))

dv_phi_joe <- Vectorize(function(u, v, param) {
  result <- ((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*(((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-param)*(1-v)^(param-2)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*((1-u)^param*param*(1-v)^(param-1)-param*(1-v)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(1-u)^(param-1)*((1-u)^param-1)*param*(1-v)^(param-1)*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))*log(1-v)-((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1))/(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-param)*(1-v)^(param-2)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*((((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)*(1/param-2)*((1-u)^param*log(1-u)*param*(1-v)^(param-1)+(1-u)^param*param*(1-v)^(param-1)*log(1-v)+((1-u)^param*(1-v)^param)/(1-v)-(param*(1-v)^(param-1)*log(1-v)+(1-v)^param/(1-v)))-(1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param))*((1-u)^param*param*(1-v)^(param-1)-param*(1-v)^(param-1)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^2-((1-u)^param*param*(1-v)^(param-1)-param*(1-v)^(param-1))/(((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)*param^2))+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*((1-u)^param*param*(1-v)^(param-1)-param*(1-v)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(1-u)^(param-1)*((1-u)^param-1)*param*(1-v)^(param-1)*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*(1/param-2)*((1-u)^param*param*(1-v)^(param-1)-param*(1-v)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+((1-u)^(param-1)*((1-u)^param*log(1-u)*param*(1-v)^(param-1)+((1-u)^param-1)*param*(1-v)^(param-1)*log(1-v)+(((1-u)^param-1)*(1-v)^param)/(1-v))+(1-u)^(param-1)*log(1-u)*((1-u)^param-1)*param*(1-v)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))-((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1)*log(1-v)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(((1/param-2)*((1-u)^param*log(1-u)+(1-v)^param*log(1-v)-((1-u)^param*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*(1-v)^param)))/((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)-log((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)/param^2)+((1-u)^(param-1)*(1-(((1-u)^param-1)*(1-v)^param*log(1-v)+(1-u)^param*log(1-u)*((1-v)^param-1)))+(1-u)^(param-1)*log(1-u)*(param-((1-u)^param-1)*((1-v)^param-1)))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1))*((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-param)*(1-v)^(param-2)+((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*(1/param-2)*((1-u)^param*param*(1-v)^(param-1)-param*(1-v)^(param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-3)+(1-u)^(param-1)*((1-u)^param-1)*param*(1-v)^(param-1)*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2))*(1-v)^(param-1)))/((1-u)^(param-1)*(param-((1-u)^param-1)*((1-v)^param-1))*((1-u)^param+(1-v)^param-(1-u)^param*(1-v)^param)^(1/param-2)*(1-v)^(param-1))^2
  return(result)
  }, vectorize.args = c("u", "v"))

z_function_joe <- Vectorize(function(u, v, param, data, du_phi_joe_vec, dv_phi_joe_vec){
  
  result <- sum(du_phi_joe_vec*(as.integer(u <= data[,1])-data[,1]))/nrow(data) +
    sum(dv_phi_joe_vec*(as.integer(v <= data[,2])-data[,2]))/nrow(data)
  
  return(result)
}, vectorize.args = c("u", "v"))





# ###### Frank copula
# 
# ### The following are algebraic expressions related to the Frank copula density
# 
# # the following expression is the log-density of the Frank copula
# expr_log_frank <- log( (param*exp(param*(1+u+v))*(-1+exp(param)))/
#                          ((exp(param) - exp(param*(1+u)) - exp(param*(1+v)) + exp(param*(u+v)))^2) )
# 
# # the following expressions are the partial derivatives of the log-density of the Frank copula
# expr_du_log_frank <- deriv(expr_log_frank, "u")
# expr_dv_log_frank <- deriv(expr_log_frank, "v")
# 
# # the following expression defines the function phi_frank, obtained by differentiating the log-density 
# # of the Frank copula with respect to the parameter
# expr_phi_frank <- deriv(expr_log_frank, "param")
# 
# # the following expressions are the partial derivatives of the phi_frank function
# expr_dparam_phi_frank <- deriv(expr_phi_frank, "param")
# expr_du_phi_frank <- deriv(expr_phi_frank, "u")
# expr_dv_phi_frank <- deriv(expr_phi_frank, "v")

### The following are the implementations of R functions related to the algebraic expressions about Frank copula

log_frank <- Vectorize(function(u, v, param) {
  result <- log( (param*exp(param*(1+u+v))*(-1+exp(param)))/
                   ((exp(param) - exp(param*(1+u)) - exp(param*(1+v)) + exp(param*(u+v)))^2) )
  return(result)
  }, vectorize.args = c("u", "v"))

d_log_frank <- Vectorize(function(u, v, param){
  du_log_frank <- (((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*exp(param*(u+v+1))*param^2*(exp(param)-1)-2*param*exp(param*(u+v+1))*(exp(param)-1)*(param*exp(param*(u+v))-param*exp(param*(u+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2)/((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1))
  dv_log_frank <- (((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*exp(param*(u+v+1))*param^2*(exp(param)-1)-2*param*exp(param*(u+v+1))*(exp(param)-1)*(param*exp(param*(u+v))-param*exp(param*(v+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2)/((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1))
  return(c(du_log_frank, dv_log_frank))
}, vectorize.args = c("u", "v"))

phi_frank <- Vectorize(function(u, v, param) {
  result <- (((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2)/((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1))
  return(result)
  }, vectorize.args = c("u", "v"))

dparam_phi_frank <- Vectorize(function(u, v, param) {
  result <- ((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1)*(2*((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))+((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*exp(param)+(param*(u+v+1)^2*exp(param*(u+v+1))+(u+v+1)*exp(param*(u+v+1))+(u+v+1)*exp(param*(u+v+1)))*(exp(param)-1))+2*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*(param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))^2+(param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-exp(param*(u+1))*(u+1)^2-exp(param*(v+1))*(v+1)^2+exp(param*(u+v))*(u+v)^2)+(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2)-((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*exp(param)+((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*(u+v+1)*exp(param*(u+v+1))+((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4+4*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^3*param)*exp(param*(u+v+1)))*(exp(param)-1)))/((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1))^2
  return(result)
  }, vectorize.args = c("u", "v"))

du_phi_frank <- Vectorize(function(u, v, param) {
  result <- ((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1)*(2*((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(param*exp(param*(u+v))-param*exp(param*(u+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))+((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(exp(param*(u+v+1))*param^2*exp(param)+((u+v+1)*param^2*exp(param*(u+v+1))+param*exp(param*(u+v+1))+param*exp(param*(u+v+1)))*(exp(param)-1))+2*(param*exp(param*(u+v))-param*exp(param*(u+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*(param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(param*exp(param*(u+v))-param*exp(param*(u+1)))+(param*exp(param*(u+v+1))*(exp(param)-1)*((u+v)*param*exp(param*(u+v))+exp(param*(u+v))-((u+1)*param*exp(param*(u+1))+exp(param*(u+1))))+exp(param*(u+v+1))*param^2*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2)-((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param^2*exp(param*(u+v+1))+4*(param*exp(param*(u+v))-param*exp(param*(u+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^3*param*exp(param*(u+v+1)))*(exp(param)-1))/((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1))^2
  return(result)
  }, vectorize.args = c("u", "v"))

dv_phi_frank <- Vectorize(function(u, v, param) {
  result <- ((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1)*(2*((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(param*exp(param*(u+v))-param*exp(param*(v+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))+((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(exp(param*(u+v+1))*param^2*exp(param)+((u+v+1)*param^2*exp(param*(u+v+1))+param*exp(param*(u+v+1))+param*exp(param*(u+v+1)))*(exp(param)-1))+2*(param*exp(param*(u+v))-param*exp(param*(v+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*(param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(param*exp(param*(u+v))-param*exp(param*(v+1)))+(param*exp(param*(u+v+1))*(exp(param)-1)*((u+v)*param*exp(param*(u+v))+exp(param*(u+v))-((v+1)*param*exp(param*(v+1))+exp(param*(v+1))))+exp(param*(u+v+1))*param^2*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2)-((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*(param*exp(param*(u+v+1))*exp(param)+(param*(u+v+1)*exp(param*(u+v+1))+exp(param*(u+v+1)))*(exp(param)-1))-2*param*exp(param*(u+v+1))*(exp(param)-1)*(exp(param)-(u+1)*exp(param*(u+1))-(v+1)*exp(param*(v+1))+(u+v)*exp(param*(u+v)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v))))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^2*((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param^2*exp(param*(u+v+1))+4*(param*exp(param*(u+v))-param*exp(param*(v+1)))*(exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^3*param*exp(param*(u+v+1)))*(exp(param)-1))/((exp(param)-exp(param*(u+1))-exp(param*(v+1))+exp(param*(u+v)))^4*param*exp(param*(u+v+1))*(exp(param)-1))^2
  return(result)
  }, vectorize.args = c("u", "v"))

z_function_frank <- Vectorize(function(u, v, param, data, du_phi_frank_vec, dv_phi_frank_vec){
  
  result <- sum(du_phi_frank_vec*(as.integer(u <= data[,1])-data[,1]))/nrow(data) +
    sum(dv_phi_frank_vec*(as.integer(v <= data[,2])-data[,2]))/nrow(data)
  
  return(result)
}, vectorize.args = c("u", "v"))





# ###### Gaussian copula
# 
# # The following two symbolic variables are specific to the Gaussian copula density. In the bivariate case, 
# # the density can be expressed via variables $z_u = \Phi^{-1}(u)$ and $z_v = \Phi^{-1}(v)$, 
# # making it easier to differentiate with respect to $z_u$ and $z_v$.
# zu <- ysym("zu")
# zv <- ysym("zv")
# 
# ### The following are algebraic expressions related to the Gaussian copula density
# 
# # the following expression is the log-density of the Gaussian copula
# expr_log_gaussian <- log( (1/sqrt(1-param^2))*(exp((zu^2 + zv^2)/2))*
#                             (exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))) )
# 
# 
# # the following expressions are the partial derivatives of the log-density of the Gaussian copula
# expr_dzu_log_gaussian <- deriv(expr_log_gaussian, "zu")
# expr_dzv_log_gaussian <- deriv(expr_log_gaussian, "zv")
# 
# # the following expression defines the function phi_gaussian, obtained by differentiating the log-density 
# # of the Gaussian copula with respect to the parameter
# #expr_phi_gaussian <- deriv(expr_log_gaussian, "param")
# 
# # the following expressions are the partial derivatives of the phi_gaussian function
# expr_dparam_phi_gaussian <- deriv(expr_phi_gaussian, "param")
# expr_dzu_phi_gaussian <- deriv(expr_phi_gaussian, "zu")
# expr_dzv_phi_gaussian <- deriv(expr_phi_gaussian, "zv")

### The following are the implementations of R functions related to the algebraic expressions about Gaussian copula

log_gaussian <- Vectorize(function(u, v, param) {
  zu <- qnorm(u)
  zv <- qnorm(v)
  result <- log( (1/sqrt(1-param^2))*(exp((zu^2 + zv^2)/2))*
                   (exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))) )
  return(result)
}, vectorize.args = c("u", "v"))

d_log_gaussian <- Vectorize(function(u, v, param) {
  zu <- qnorm(u)
  zv <- qnorm(v)
  du_log_gaussian <- ((exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*zu*exp((zu^2+zv^2)/2)+(exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zv-2*zu))/(2*(1-param^2)))*sqrt(1-param^2))/(sqrt(1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2))/(dnorm(qnorm(u)))
  dv_log_gaussian <- ((exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*zv*exp((zu^2+zv^2)/2)+(exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zu-2*zv))/(2*(1-param^2)))*sqrt(1-param^2))/(sqrt(1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2))/(dnorm(qnorm(v)))
  return(c(du_log_gaussian, dv_log_gaussian))
}, vectorize.args = c("u", "v"))

phi_gaussian <- Vectorize(function(u, v, param) {
  zu <- qnorm(u)
  zv <- qnorm(v)
  result <- (((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(-2*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*param)/(2*sqrt(1-param^2)))*sqrt(1-param^2))/((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2))
  return(result)
}, vectorize.args = c("u", "v"))

dparam_phi_gaussian <- Vectorize(function(u, v, param) {
  zu <- qnorm(u)
  zv <- qnorm(v)
  result <- ((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*((((2*(1-param^2))^2*(sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*((-8)*param*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2+2*zu*zv*param))+((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*param)/sqrt(1-param^2))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))-(-16)*sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param)*param*(1-param^2))/(2*(1-param^2))^4-((-4)*sqrt(1-param^2)*(exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)+(param*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2)-(-(-4)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*param^2)/sqrt(1-param^2))/(2*sqrt(1-param^2))^2)*sqrt(1-param^2)-(((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(-2*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*param)/(2*sqrt(1-param^2)))*param)/sqrt(1-param^2))-((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(-2*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*param)/(2*sqrt(1-param^2)))*sqrt(1-param^2)*(((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-2*param*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2))))*exp((zu^2+zv^2)/2))/((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2))^2
  return(result)
}, vectorize.args = c("u", "v"))

du_phi_gaussian <- Vectorize(function(u, v, param) {
  zu <- qnorm(u)
  zv <- qnorm(v)
  result <- ((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zv-(-4)*(2*param*zv-2*zu)*param)+((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zv-2*zu))/(2*(1-param^2))+sqrt(1-param^2)*zu*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2))))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(-2*(exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*zu*exp((zu^2+zv^2)/2)+(exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zv-2*zu))/(2*(1-param^2)))*param)/(2*sqrt(1-param^2)))*sqrt(1-param^2)-((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(-2*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*param)/(2*sqrt(1-param^2)))*sqrt(1-param^2)*((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*zu*exp((zu^2+zv^2)/2)+(exp((zu^2+zv^2)/2)*(1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zv-2*zu))/(2*(1-param^2))))/((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2))^2
  result <- result/(dnorm(qnorm(u)))
  return(result)
}, vectorize.args = c("u", "v"))

dv_phi_gaussian <- Vectorize(function(u, v, param) {
  zu <- qnorm(u)
  zv <- qnorm(v)
  result <- ((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu-(-4)*(2*param*zu-2*zv)*param)+((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zu-2*zv))/(2*(1-param^2))+sqrt(1-param^2)*zv*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2))))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(-2*(exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*zv*exp((zu^2+zv^2)/2)+(exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zu-2*zv))/(2*(1-param^2)))*param)/(2*sqrt(1-param^2)))*sqrt(1-param^2)-((sqrt(1-param^2)*exp((zu^2+zv^2)/2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(4*(1-param^2)*zu*zv-(-4)*(2*param*zu*zv-zu^2-zv^2)*param))/(2*(1-param^2))^2-(-2*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2)*param)/(2*sqrt(1-param^2)))*sqrt(1-param^2)*((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*zv*exp((zu^2+zv^2)/2)+(exp((zu^2+zv^2)/2)*(1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*(2*param*zu-2*zv))/(2*(1-param^2))))/((1-param^2)*exp((2*param*zu*zv-zu^2-zv^2)/(2*(1-param^2)))*exp((zu^2+zv^2)/2))^2
  result <- result/dnorm(qnorm(v))
  return(result)
}, vectorize.args = c("u", "v"))

z_function_gaussian <- Vectorize(function(u, v, param, data, du_phi_gaussian_vec, dv_phi_gaussian_vec){
  result <- sum(du_phi_gaussian_vec*(as.integer(u <= data[,1])-data[,1]))/nrow(data) +
    sum(dv_phi_gaussian_vec*(as.integer(v <= data[,2])-data[,2]))/nrow(data)
  return(result)
}, vectorize.args = c("u", "v"))




###### Next, we will define a list of all the above functions so that we can easily select the appropriate ones


log_copula_LIST <- list(
  clayton = log_clayton,
  gumbel = log_gumbel,
  joe = log_joe,
  frank = log_frank,
  gaussian = log_gaussian
)

d_log_copula_LIST <- list(
  clayton = d_log_clayton,
  gumbel = d_log_gumbel,
  joe = d_log_joe,
  frank = d_log_frank,
  gaussian = d_log_gaussian
)

phi_copula_LIST <- list(
  clayton = phi_clayton,
  gumbel = phi_gumbel,
  joe = phi_joe,
  frank = phi_frank,
  gaussian = phi_gaussian
)

dparam_phi_copula_LIST <- list(
  clayton = dparam_phi_clayton,
  gumbel = dparam_phi_gumbel,
  joe = dparam_phi_joe,
  frank = dparam_phi_frank,
  gaussian = dparam_phi_gaussian
)

du_phi_copula_LIST <- list(
  clayton = du_phi_clayton,
  gumbel = du_phi_gumbel,
  joe = du_phi_joe,
  frank = du_phi_frank,
  gaussian = du_phi_gaussian
)

dv_phi_copula_LIST <- list(
  clayton = dv_phi_clayton,
  gumbel = dv_phi_gumbel,
  joe = dv_phi_joe,
  frank = dv_phi_frank,
  gaussian = dv_phi_gaussian
)

z_function_copula_LIST <- list(
  clayton = z_function_clayton,
  gumbel = z_function_gumbel,
  joe = z_function_joe,
  frank = z_function_frank,
  gaussian = z_function_gaussian
)